<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Attendance Management</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <style>
        /* Стиль для фильтров */
        .filter {
            cursor: pointer;
            padding: 5px;
            background: #f0f0f0;
            margin: 5px;
            width: 120px;
            border-radius: 4px;
            text-align: center;
        }

        .filter-content {
            display: none;
            padding: 10px;
            background: #fff;
            border-radius: 4px;
            margin-top: 5px;
        }

        .filter.active .filter-content {
            display: block;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 8px;
            border: 1px solid #ddd;
        }

        th {
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
    {% include 'navbar.html' %}
    <h1>Attendance Management</h1>

    <!-- Форма фильтрации -->
    <form method="GET" action="{{ url_for('teacher.attendance') }}">
        <div class="filters">
            <!-- Фильтр по курсу -->
            <div class="filter">
                Курс
                <div class="course-filter">
                    <select name="course" id="course-filter" onchange="updateLessons()">
                        <option value="">Select a course</option>
                        {% for course in courses %}
                            <option value="{{ course.id }}" {% if course.id in course_filter %}selected{% endif %}>
                                {{ course.name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <!-- Фильтр по дате (будет обновляться через JS) -->
            <div class="filter">
                Дата
                <div class="date-filter">
                    <select name="date" id="date-filter">
                        <option value="">Select a date</option>
                        {% if lessons %}
                            {% for lesson in lessons %}
                                <option value="{{ lesson.date }}" {% if lesson.date in date_filter %}selected{% endif %}>
                                    {{ lesson.date }}
                                </option>
                            {% endfor %}
                        {% endif %}
                    </select>
                </div>
            </div>

            <!-- Фильтр по статусу -->
            <div class="filter">
                Статус
                <div class="status-filter">
                    <select name="status" id="status-filter" multiple>
                        <option value="was" {% if 'was' in status_filter %}selected{% endif %}>Was</option>
                        <option value="not" {% if 'not' in status_filter %}selected{% endif %}>Not</option>
                    </select>
                </div>
            </div>
        </div>

        <button type="submit">Apply Filters</button>
        <a href="{{ url_for('teacher.attendance') }}">Reset Filters</a>
    </form>

    <!-- Таблица -->
    <table border="1">
        <thead>
            <tr>
                <th>Student Name</th>
                <th>Course</th>
                <th>Date</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for record in attendance_records %}
                <tr>
                    <td>{{ record.student.full_name }}</td>
                    <td>{{ record.lesson.course.name }}</td>
                    <td>{{ record.lesson.date }}</td>
                    <td>{{ record.status }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        // Функция для обновления списка дат в зависимости от выбранного курса
        function updateLessons() {
            const courseId = document.getElementById('course-filter').value;
            const dateSelect = document.getElementById('date-filter');

            // Очищаем текущий список дат
            dateSelect.innerHTML = "<option value=''>Select a date</option>";

            // Загружаем уроки для выбранного курса
            if (courseId) {
                fetch(`/get_lessons_for_course/${courseId}`)
                    .then(response => response.json())
                    .then(data => {
                        data.lessons.forEach(lesson => {
                            const option = document.createElement("option");
                            option.value = lesson.date;
                            option.text = lesson.date;
                            dateSelect.appendChild(option);
                        });
                    });
            }
        }

    </script>
</body>
</html>
